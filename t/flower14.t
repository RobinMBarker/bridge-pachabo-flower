use strict;
use Test::More tests => 5;

BEGIN { 
    push @INC, -d 'blib' ? qw(blib/script) :
    do{ require Config;
        $Config::Config{installsitescript} 
    }
}

my $require_ok = eval { require q(flower); };

ok( $require_ok, 'flower.perl script' );

{
    my $warn;
    local $SIG{__WARN__} = sub { $warn .= $_[0] };
    require File::Temp;
    my $file = File::Temp->new( SUFFIX => '.txt' )->filename;
    local @ARGV = (qw(-n Pachabo -s), q(7,6), q(-F), $file);
    main();
    ok( -e $file, 'flower.perl -s 7,6' );
    like($warn,
        qr{^ Movement \s+ written \s+ to  
            \s+ \Q$file\E $}msx, 
       'flower.perl -s - warning');

  SKIP: {
    eval {require Text::CSV; Text::CSV->import('csv'); 1 } or
        skip 2, "No Text::CSV";

    my $got = csv(in=>$file);
    ok( defined $got, 'flower.perl -s - output');
    my $expect = csv(in=>\*DATA);
    is_deeply($got, $expect, 'flower.perl -s - checked');
  }
}


__DATA__

Pachabo T14: EW +2: Session 1: Rounds 1-7
5,14,56,8,7
1,14,1, 1,3,2, 1,5,3, 1,7,4, 1,9,5, 1,11,6, 1,13,7
2,13,1, 2,14,2, 2,4,3, 2,6,4, 2,8,5, 2,10,6, 2,12,7
3,12,1, 3,1,2, 3,14,3, 3,5,4, 3,7,5, 3,9,6, 3,11,7
4,11,1, 4,13,2, 4,2,3, 4,14,4, 4,6,5, 4,8,6, 4,10,7
5,10,1, 5,12,2, 5,1,3, 5,3,4, 5,14,5, 5,7,6, 5,9,7
6,9,1, 6,11,2, 6,13,3, 6,2,4, 6,4,5, 6,14,6, 6,8,7
7,8,1, 7,10,2, 7,12,3, 7,1,4, 7,3,5, 7,5,6, 7,14,7
8,7,1, 8,9,2, 8,11,3, 8,13,4, 8,2,5, 8,4,6, 8,6,7
9,6,1, 9,8,2, 9,10,3, 9,12,4, 9,1,5, 9,3,6, 9,5,7
10,5,1, 10,7,2, 10,9,3, 10,11,4, 10,13,5, 10,2,6, 10,4,7
11,4,1, 11,6,2, 11,8,3, 11,10,4, 11,12,5, 11,1,6, 11,3,7
12,3,1, 12,5,2, 12,7,3, 12,9,4, 12,11,5, 12,13,6, 12,2,7
13,2,1, 13,4,2, 13,6,3, 13,8,4, 13,10,5, 13,12,6, 13,1,7
14,1,1, 14,2,2, 14,3,3, 14,4,4, 14,5,5, 14,6,6, 14,7,7

Pachabo T14: EW +2: Session 2: Rounds 8-13
5,14,48,8,6
1,2,1, 1,4,2, 1,6,3, 1,8,4, 1,10,5, 1,12,6
2,1,1, 2,3,2, 2,5,3, 2,7,4, 2,9,5, 2,11,6
3,13,1, 3,2,2, 3,4,3, 3,6,4, 3,8,5, 3,10,6
4,12,1, 4,1,2, 4,3,3, 4,5,4, 4,7,5, 4,9,6
5,11,1, 5,13,2, 5,2,3, 5,4,4, 5,6,5, 5,8,6
6,10,1, 6,12,2, 6,1,3, 6,3,4, 6,5,5, 6,7,6
7,9,1, 7,11,2, 7,13,3, 7,2,4, 7,4,5, 7,6,6
8,14,1, 8,10,2, 8,12,3, 8,1,4, 8,3,5, 8,5,6
9,7,1, 9,14,2, 9,11,3, 9,13,4, 9,2,5, 9,4,6
10,6,1, 10,8,2, 10,14,3, 10,12,4, 10,1,5, 10,3,6
11,5,1, 11,7,2, 11,9,3, 11,14,4, 11,13,5, 11,2,6
12,4,1, 12,6,2, 12,8,3, 12,10,4, 12,14,5, 12,1,6
13,3,1, 13,5,2, 13,7,3, 13,9,4, 13,11,5, 13,14,6
14,8,1, 14,9,2, 14,10,3, 14,11,4, 14,12,5, 14,13,6
